{"id":"seeds-fb8b","title":"Foundation + Engine: project scaffold, core data layer, composition engine","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-23T18:42:22.174Z","updatedAt":"2026-02-23T19:02:27.419Z","blocks":["seeds-2d63"],"closedAt":"2026-02-23T19:02:27.419Z","closeReason":"Foundation + Engine complete. Builder implemented: project scaffold (package.json, tsconfig, biome, CI), core data layer (types, store with advisory locking + atomic writes, id generation, yaml parser, config loader, output helpers), composition engine (render with inheritance resolution + cycle detection + depth cap, validate with schema rules), CLI entry with all 17 commands, 61 passing tests, lint clean, typecheck clean. Branch overstory/foundation-builder/seeds-781c ready for merge."}
{"id":"seeds-0290","title":"Infrastructure: CI/CD workflows, scripts, release command, changelog","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-23T18:42:25.768Z","updatedAt":"2026-02-23T18:50:24.770Z","closedAt":"2026-02-23T18:50:24.770Z","closeReason":"Infrastructure complete: 9 files delivered across 2 builders. Config files (package.json, tsconfig.json, biome.json, .gitignore, CHANGELOG.md) and CI/CD files (.github/workflows/ci.yml, auto-tag.yml, scripts/version-bump.ts, .claude/commands/release.md). Both branches merge_ready."}
{"id":"seeds-2d63","title":"CLI + Commands: entry point, all 17 command files, command tests","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-23T18:42:29.958Z","updatedAt":"2026-02-23T22:34:41.893Z","blockedBy":["seeds-fb8b"],"closedAt":"2026-02-23T22:34:41.893Z","closeReason":"CLI + Commands implemented and merged as part of full canopy build (seeds-5503)."}
{"id":"seeds-067b","title":"Build: project config files (package.json, tsconfig, biome, gitignore, changelog)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-23T18:44:14.985Z","updatedAt":"2026-02-23T18:47:28.423Z","closedAt":"2026-02-23T18:47:28.423Z","closeReason":"Config builder delivered package.json, tsconfig.json, biome.json, .gitignore, CHANGELOG.md"}
{"id":"seeds-15a9","title":"Build: CI/CD workflows, version-bump script, release command","status":"closed","type":"task","priority":1,"createdAt":"2026-02-23T18:44:15.547Z","updatedAt":"2026-02-23T18:47:29.336Z","closedAt":"2026-02-23T18:47:29.336Z","closeReason":"CI/CD builder delivered ci.yml, auto-tag.yml, version-bump.ts, release.md"}
{"id":"seeds-781c","title":"Build: project scaffold, core data layer, and composition engine","status":"closed","type":"task","priority":1,"createdAt":"2026-02-23T18:45:49.886Z","updatedAt":"2026-02-23T19:01:45.580Z","closedAt":"2026-02-23T19:01:45.580Z","closeReason":"Implemented complete foundation: scaffold (package.json, tsconfig, biome, CI), core data layer (types, store with locking, id, config, yaml, output), composition engine (render with inheritance, validate with schemas), CLI entry with all 17 commands. 61 tests pass, lint clean, typecheck clean."}
{"id":"seeds-5503","title":"Build canopy: project config, core data layer, composition engine, CLI + all 17 commands, tests","status":"closed","type":"task","priority":1,"createdAt":"2026-02-23T21:55:23.369Z","updatedAt":"2026-02-23T22:34:37.197Z","closedAt":"2026-02-23T22:34:37.197Z","closeReason":"Merged to main. Full implementation complete."}
{"id":"seeds-dfa3","title":"cn import: parse H2 headings into separate sections by default","status":"closed","type":"feature","priority":3,"createdAt":"2026-02-23T23:37:13.973Z","updatedAt":"2026-02-24T00:04:40.471Z","description":"Currently `cn import` puts the entire file into a single 'body' section. It should parse ## headings into separate named sections by default (the --split flag exists but isn't the default), making imported prompts immediately useful for validation and diffing.","closedAt":"2026-02-24T00:04:40.471Z"}
{"id":"seeds-db24","title":"cn create: add --help subcommand help","status":"closed","type":"feature","priority":4,"createdAt":"2026-02-23T23:37:16.897Z","updatedAt":"2026-02-24T00:04:40.471Z","description":"Running `cn create --help` just gives '--name is required' instead of showing available flags for the create command. Each subcommand should support --help to show its own flags.","closedAt":"2026-02-24T00:04:40.471Z"}
{"id":"seeds-0fd2","title":"cn show: display sections in human-readable output","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-23T23:37:19.757Z","updatedAt":"2026-02-24T00:04:40.471Z","description":"The human-readable output of `cn show` only displays name/version/status metadata. Sections (the actual prompt content) are invisible unless you use --json or render. The show command should display sections in human mode too.","closedAt":"2026-02-24T00:04:40.471Z"}
{"id":"seeds-69e6","title":"cn create: --description flag silently ignored","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-23T23:37:23.080Z","updatedAt":"2026-02-24T00:04:40.471Z","description":"Passing --description to cn create is silently ignored — the flag isn't parsed and the Prompt type doesn't have a description field. Either add support or reject the unknown flag.","closedAt":"2026-02-24T00:04:40.471Z"}
{"id":"seeds-d1aa","title":"cn: error messages print twice on stderr","status":"closed","type":"bug","priority":3,"createdAt":"2026-02-23T23:37:25.868Z","updatedAt":"2026-02-24T00:04:40.471Z","description":"Error messages print twice, e.g. '--name is required' followed by another '--name is required'. This appears to happen because errorOut prints once, and then process.exit propagates to the top-level catch which prints again.","closedAt":"2026-02-24T00:04:40.471Z"}
{"id":"seeds-5ab5","title":"Add tests for update command","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T00:20:22.048Z","updatedAt":"2026-02-25T14:41:45.330Z","description":"update.ts is the most complex command (~160 LOC) handling section/tag/metadata mutations. Needs integration tests covering: section add/remove/replace, tag mutations, metadata updates, version bumping. Follow existing anti-mocking pattern with real temp dirs and JSONL files.","closedAt":"2026-02-25T14:41:45.330Z","closeReason":"22 integration tests for update command: section CRUD, tag mutations, metadata updates, version bumping, JSON output, error cases"}
{"id":"seeds-cbc6","title":"Add tests for sync command","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T00:20:24.148Z","updatedAt":"2026-02-25T14:41:46.246Z","description":"sync.ts handles git integration (spawning git, atomic commits). Needs tests for: successful sync, git failure handling, commit message formatting. Use real temp git repos (git init in tmpdir) following mulch's anti-mocking patterns.","closedAt":"2026-02-25T14:41:46.246Z","closeReason":"9 integration tests for sync command: clean state, commit flow, date format, --status mode, --json output, non-git error handling"}
{"id":"seeds-097e","title":"Add tests for list command","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T00:20:25.565Z","updatedAt":"2026-02-25T14:42:59.455Z","description":"list.ts handles filtering prompts by tag, status, and extends. Needs integration tests covering: filter by tag, filter by status, filter by extends/parent, combination filters, --json output, empty results.","closedAt":"2026-02-25T14:42:59.455Z","closeReason":"Added list.test.ts with 11 integration tests covering filter by tag/status/extends, combination filters, JSON output, empty results, and archived exclusion"}
{"id":"seeds-4482","title":"Add tests for archive command","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T00:20:27.295Z","updatedAt":"2026-02-25T14:43:00.738Z","description":"archive.ts handles status transitions (active → archived). Needs tests for: archiving a prompt, unarchiving, archiving already-archived prompt, verifying JSONL state after archive.","closedAt":"2026-02-25T14:43:00.738Z","closeReason":"Added archive.test.ts with 7 integration tests covering archive, unarchive, already-archived error, nonexistent error, JSONL state verification, JSON output"}
{"id":"seeds-26b6","title":"Add tests for history command","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T00:20:28.329Z","updatedAt":"2026-02-25T14:43:01.183Z","description":"history.ts handles version querying and filtering. Needs tests for: listing versions of a prompt, version pagination/limiting, --json output format.","closedAt":"2026-02-25T14:43:01.183Z","closeReason":"Added history.test.ts with 12 integration tests covering version listing, --limit pagination, JSON output, error handling, version ordering, current marker"}
{"id":"seeds-28cc","title":"Add tests for pin command","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T00:20:29.484Z","updatedAt":"2026-02-25T14:42:59.365Z","description":"pin.ts handles version pinning and unpinning. Needs tests for: pinning a prompt to a version, unpinning, pinning to nonexistent version, verifying pinned state persists in JSONL.","closedAt":"2026-02-25T14:42:59.365Z","closeReason":"Added pin.test.ts with 12 tests covering pin/unpin commands: pinning to version, JSON output, JSONL persistence, error cases (nonexistent version/prompt/missing args/invalid version), and unpinning."}
{"id":"seeds-28d1","title":"Add tests for show command","status":"closed","type":"task","priority":3,"createdAt":"2026-02-24T00:20:30.801Z","updatedAt":"2026-02-25T14:43:00.764Z","description":"show.ts is already tested indirectly through create.test.ts and schema.test.ts. Add standalone tests for: showing specific version, showing nonexistent prompt, --json output, section display formatting.","closedAt":"2026-02-25T14:43:00.764Z","closeReason":"Added show.test.ts with 9 tests covering show command: show by name, JSON output, name@version syntax, specific/latest version, nonexistent prompt/version errors, section display, extends display."}
{"id":"seeds-fc16","title":"Add tests for tree command","status":"closed","type":"task","priority":3,"createdAt":"2026-02-24T00:20:32.080Z","updatedAt":"2026-02-25T14:43:01.783Z","description":"tree.ts handles ancestry/descendant traversal of prompt inheritance. Needs tests for: single parent chain, multiple children, deep hierarchy, orphan prompts, --json output.","closedAt":"2026-02-25T14:43:01.783Z","closeReason":"Added tree.test.ts with 9 tests covering tree command: orphan prompt, parent chain, multiple children, deep hierarchy, JSON output with ancestors/children, error cases."}
{"id":"seeds-8411","title":"Add concurrent access tests for store locks","status":"closed","type":"task","priority":3,"createdAt":"2026-02-24T00:20:33.841Z","updatedAt":"2026-02-25T14:41:49.463Z","description":"store.ts has lock acquire/release tested but not concurrent access patterns. Following mulch's lock.test.ts pattern, add tests for: parallel writes with Promise.all(), stale lock cleanup, lock timeout behavior.","closedAt":"2026-02-25T14:41:49.463Z","closeReason":"3 concurrent lock tests added to store.test.ts: parallel write serialization, stale lock cleanup, lock timeout behavior"}
{"id":"seeds-4b20","title":"Section headings should not be lowercased/slugified","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T02:48:51.935Z","updatedAt":"2026-02-24T02:51:35.551Z","description":"When importing markdown with `--split`, section headings are lowercased and slugified (e.g. `## Quality Gates` becomes `quality-gates`). This happens at a single point in `src/commands/import.ts:29`:\n\n```ts\ncurrentName = heading.toLowerCase().replace(/\\s+/g, \"-\");\n```\n\nThe slugified name is then stored as-is in JSONL and rendered back verbatim in `cn emit` / `cn show`, so `## Quality Gates` round-trips to `## quality-gates`. This loses the original casing and spacing of the author's headings.\n\nSection names created directly via `cn create --section` are *not* transformed, so there's already an inconsistency.\n\n**Fix:** preserve the original heading text as the section name instead of slugifying it. Update the test in `src/commands/emit.test.ts:115-139` which currently asserts the lowercased behavior.","closedAt":"2026-02-24T02:51:35.551Z"}
{"id":"seeds-f49f","title":"cn init: fix .gitattributes check — skips canopy entries if merge=union already present","status":"closed","type":"bug","priority":2,"createdAt":"2026-02-24T02:53:36.002Z","updatedAt":"2026-02-24T14:58:20.501Z","description":"init.ts line 54 checks `existing.includes('merge=union')` which is too broad. If another tool (seeds, mulch) already added merge=union entries for their own JSONL files, canopy's entries are silently skipped. Should check for canopy-specific paths instead (e.g. `.canopy/prompts.jsonl`).","closedAt":"2026-02-24T14:58:20.501Z"}
{"id":"seeds-0fde","title":"Adopt Commander for CLI parsing","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-24T03:29:49.948Z","updatedAt":"2026-02-24T04:25:17.943Z","description":"Replace the manual process.argv parsing (switch statement in src/index.ts, per-command flag helpers) with Commander. Benefits: structured arg/option definitions, auto-generated help, choice validation, built-in version display. Each command in src/commands/ should export a register function. Notable: Canopy has subcommands (schema create/show/list, schema rule add) — Commander supports this via .command().command() nesting. Business logic stays untouched — only parsing/routing changes.","blocks":["seeds-787b","seeds-3162"],"closedAt":"2026-02-24T04:25:17.943Z"}
{"id":"seeds-787b","title":"Adopt chalk for output formatting","status":"closed","type":"feature","priority":1,"createdAt":"2026-02-24T03:29:52.109Z","updatedAt":"2026-02-24T07:27:51.139Z","description":"Replace raw ANSI codes in src/output.ts with chalk. Currently using manual NO_COLOR/TTY detection and c.bold/c.dim/c.green/c.red/c.yellow/c.cyan/c.blue helpers. Chalk handles terminal capability detection automatically. Preserve the humanOut/jsonOut/errorOut helper pattern but use chalk underneath. Success: ✔ (green). Errors: 'Error:' prefix (red).","blockedBy":["seeds-0fde"],"closedAt":"2026-02-24T07:27:51.139Z","closeReason":"Chalk adoption completed by chalk-exit-builder. chalk@5.6.2 installed, src/output.ts rewritten to use chalk for all color/style helpers. All 83 tests pass, lint and typecheck clean."}
{"id":"seeds-3162","title":"Use process.exitCode instead of process.exit()","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-24T03:29:54.919Z","updatedAt":"2026-02-24T07:27:51.155Z","description":"Canopy has a custom ExitError class and uses both process.exit(1) and throw ExitError(1). Switch to process.exitCode = 1 for testability. The ExitError class can remain for internal flow control but the top-level handler should set process.exitCode rather than calling process.exit(). Standardize JSON error shape to { success: false, command, error }.","blockedBy":["seeds-0fde"],"closedAt":"2026-02-24T07:27:51.155Z"}
{"id":"seeds-5cc2","title":"Core: install commander, rewrite index.ts, migrate simple commands","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T03:58:41.588Z","updatedAt":"2026-02-24T04:25:17.961Z","description":"Install commander package. Rewrite src/index.ts to use Commander program with register pattern. Migrate simple commands (init, show, list, archive, history, tree, stats, sync, diff, render) to export register(program) functions. Each command keeps its default() export for test compatibility.","closedAt":"2026-02-24T04:25:17.961Z"}
{"id":"seeds-625b","title":"Migrate complex commands to Commander","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T03:58:43.501Z","updatedAt":"2026-02-24T04:25:17.977Z","description":"Migrate complex commands to Commander register pattern: create, update, emit, pin/unpin, schema (with subcommands create/show/list/rule-add), validate, import, prime, onboard. Handle repeatable flags, subcommand nesting, and preserve existing behavior.","closedAt":"2026-02-24T04:25:17.977Z"}
{"id":"seeds-3c3c","title":"Fix typecheck: install commander types and add opts type annotations","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-24T04:14:23.291Z","updatedAt":"2026-02-24T04:25:18.011Z","description":"After Commander migration merge, typecheck fails: (1) commander module not found - needs bun install, (2) implicit any on opts parameters in create.ts:186, emit.ts:242, import.ts:178, onboard.ts:145, prime.ts:167, schema.ts:304+338, update.ts:212, validate.ts:159. Fix: bun install to get commander types, then add explicit type annotations to all opts params.","closedAt":"2026-02-24T04:25:18.011Z"}
{"id":"seeds-6205","title":"Fix typecheck: bun install + opts type annotations","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-24T04:21:09.415Z","updatedAt":"2026-02-24T04:25:17.994Z","description":"Run bun install and add Record<string, unknown> type to 9 opts params in Commander action callbacks","closedAt":"2026-02-24T04:25:17.994Z"}
{"id":"seeds-f8c4","title":"Wire all 20 commands through register in index.ts (remove pass-through)","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T04:25:27.381Z","updatedAt":"2026-02-24T04:33:50.515Z","description":"index.ts still uses addPassThrough for 10 complex commands (create, update, emit, schema, validate, import, prime, onboard, pin, unpin) instead of calling their register() exports. Wire all 20 through the register pattern, remove addPassThrough helper, and remove isJsonMode import from output.ts if no longer needed.","closedAt":"2026-02-24T04:33:50.515Z"}
{"id":"seeds-7f66","title":"Rewrite index.ts: wire all 20 commands via register pattern, remove addPassThrough","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T04:28:41.357Z","updatedAt":"2026-02-24T04:33:50.531Z","description":"Replace addPassThrough helper and manual pin/unpin blocks with register() imports for create, update, emit, schema, validate, import, prime, onboard, pin (handles both pin+unpin). Keep isJsonMode import for catch handler.","closedAt":"2026-02-24T04:33:50.531Z"}
{"id":"seeds-487f","title":"Adopt chalk in output.ts and replace process.exit with process.exitCode in index.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T04:48:25.192Z","updatedAt":"2026-02-24T07:27:51.171Z","description":"Two changes: (1) bun add chalk, replace raw ANSI in src/output.ts c.* helpers with chalk equivalents, remove manual NO_COLOR/TTY detection. (2) In src/index.ts error handler, replace process.exit(1) with process.exitCode = 1 and process.exit(err.exitCode) with process.exitCode = err.exitCode. Standardize JSON error shape to { success: false, command, error }.","closedAt":"2026-02-24T07:27:51.171Z"}
{"id":"seeds-1515","title":"Run bun install to resolve chalk dependency","status":"closed","type":"bug","priority":1,"createdAt":"2026-02-24T05:57:29.328Z","updatedAt":"2026-02-24T07:27:51.188Z","description":"Tests fail after chalk merge: Cannot find package 'chalk'. Need bun install on main to install the dependency. Just run bun install and commit bun.lockb.","closedAt":"2026-02-24T07:27:51.188Z"}
{"id":"seeds-0eac","title":"Run bun install and commit lockfile","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T06:11:18.918Z","updatedAt":"2026-02-24T07:27:51.204Z","description":"Run bun install to resolve chalk@5.6.2 and commander@14.0.3 dependencies. Commit bun.lockb. Verify bun test passes.","closedAt":"2026-02-24T07:27:51.204Z"}
{"id":"seeds-91a5","title":"Build: adopt chalk in output.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T06:56:03.020Z","updatedAt":"2026-02-24T07:13:52.832Z","closedAt":"2026-02-24T07:13:52.832Z","closeReason":"Redundant — work already completed by chalk-exit-builder on seeds-487f"}
{"id":"seeds-a1a1","title":"update: --remove-section should delete entry for non-inheriting prompts","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-24T13:48:11.162Z","updatedAt":"2026-02-24T14:58:19.935Z","description":"Currently --remove-section always sets body to empty string. This is correct for prompts that use extends (empty body = suppress inherited section in render.ts mergeSections). But for prompts without inheritance, keeping a body='' entry is noise and confusing — agents expect the section to be gone. Proposed fix: if the prompt has no extends field, splice the section from the array entirely. If it does extend, keep current body='' behavior. This avoids version bloat from agents doing --remove-section then being surprised the section is still there.","closedAt":"2026-02-24T14:58:19.935Z"}
{"id":"seeds-278f","title":"update: support repeatable --add-section and --remove-section","status":"closed","type":"feature","priority":2,"createdAt":"2026-02-24T13:48:12.781Z","updatedAt":"2026-02-24T14:58:19.526Z","description":"Currently cn update only supports one --add-section, one --section, and one --remove-section per invocation. Adding 5 sections requires 5 separate cn update calls, creating 5 versions. The --tag flag already supports repeating. Section flags should too: cn update foo --add-section a=body1 --add-section b=body2 --add-section c=body3 should create a single new version with all 3 sections added. This requires changing the parsing from single variables (addSectionName/addSectionBody) to arrays, similar to how addTags works. The Commander registration also needs the accumulator pattern used by --tag.","closedAt":"2026-02-24T14:58:19.526Z"}
{"id":"seeds-1e59","title":"Visual Branding Overhaul","status":"closed","type":"epic","priority":1,"createdAt":"2026-02-24T16:59:35.792Z","updatedAt":"2026-02-24T17:48:52.579Z","description":"Align all Canopy CLI output with the os-eco visual spec (visual-spec.md). Touches output.ts and every command file. Implement brand color palette, help screen Style A, status icons Set D, message format alignment, and ID/reference highlighting.","closedAt":"2026-02-24T17:48:52.579Z","closeReason":"Visual Branding Overhaul complete: palette (seeds-4a4d), help screen Style A (seeds-7057), Set D icons (seeds-2cbc), message formats (seeds-af72), ID highlighting (seeds-4d5b) all implemented and merged."}
{"id":"seeds-c293","title":"CLI Standards Compliance","status":"open","type":"epic","priority":1,"createdAt":"2026-02-24T16:59:36.895Z","updatedAt":"2026-02-24T16:59:36.895Z","description":"Add missing global flags and standardize structural CLI behavior per cli-standards.md. Includes --version --json envelope, --quiet/-q, --verbose, --timing, JSON error routing audit, and process.exitCode audit."}
{"id":"seeds-c63a","title":"Missing Commands: doctor & upgrade","status":"open","type":"epic","priority":2,"createdAt":"2026-02-24T16:59:37.890Z","updatedAt":"2026-02-24T16:59:37.890Z","description":"Implement cn doctor (8 checks + --fix) and cn upgrade (self-update + --check) commands per cli-standards.md."}
{"id":"seeds-e2ae","title":"Developer Experience Polish","status":"open","type":"epic","priority":3,"createdAt":"2026-02-24T16:59:38.935Z","updatedAt":"2026-02-24T16:59:38.935Z","description":"Quality-of-life CLI improvements: typo suggestions for unknown commands, shell completions generation (bash/zsh/fish)."}
{"id":"seeds-4a4d","title":"Implement brand color palette in output.ts","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T16:59:45.417Z","updatedAt":"2026-02-24T17:49:08.028Z","description":"Replace generic chalk colors with brand palette from visual-spec.md. Canopy deep green rgb(56,142,60) for brand, amber rgb(255,183,77) for accents/IDs, stone gray rgb(120,120,110) for muted metadata. Export named palette constants (e.g. brand, accent, muted) wrapping chalk.rgb().","blocks":["seeds-7057","seeds-2cbc","seeds-af72","seeds-4d5b"],"closedAt":"2026-02-24T17:49:08.028Z","closeReason":"Brand color palette implemented in output.ts: palette.brand, palette.accent, palette.muted as chalk instances."}
{"id":"seeds-7057","title":"Rewrite help screen to Style A","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T16:59:48.908Z","updatedAt":"2026-02-24T17:49:08.873Z","description":"Override commander's default help with Style A template from visual-spec.md. Line 1: tool name (brand color + bold) + version (dim) + dash + tagline. Command names in ANSI green, args dim, flags dim. Two-space indent, descriptions aligned at column 20. Footer: Run 'cn <command> --help' for command-specific help.","blockedBy":["seeds-4a4d"],"closedAt":"2026-02-24T17:49:08.873Z","closeReason":"Help screen Style A implemented via configureHelp() override in index.ts."}
{"id":"seeds-2cbc","title":"Switch status icons to Set D","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T16:59:51.306Z","updatedAt":"2026-02-24T17:28:01.620Z","description":"Replace current status icons (✓ ✗ ~ ◀) with Set D from visual-spec.md: - (open/pending, green), > (in_progress/active, cyan), x (closed/done, dim), ! (blocked/warning, yellow). Update all command files that render status indicators.","blockedBy":["seeds-4a4d"],"closedAt":"2026-02-24T17:28:01.620Z","closeReason":"Implemented Set D status icons: added icons export to output.ts (open: green '-', active: cyan '>', closed: dim 'x', blocked: yellow '\\!'), fixed archive.ts success icon (yellow → brand green), replaced history.ts ◀ current marker with Set D '>' icon. All quality gates pass."}
{"id":"seeds-af72","title":"Align message formats to visual spec","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T16:59:54.670Z","updatedAt":"2026-02-24T17:48:45.487Z","description":"Update success/warning/error/info message formatting across all commands per visual-spec.md. Success: brand color ✓ + message, accent for IDs. Warning: yellow ! + yellow message + dim hint. Error: red ✗ + red message + dim hint. Info: dim text, no prefix, indented. Ensure hints always include remediation suggestion.","blockedBy":["seeds-4a4d"],"closedAt":"2026-02-24T17:48:45.487Z","closeReason":"Implemented via merge-fix-builder: fmt.success, fmt.warning, fmt.error, fmt.info helpers added to output.ts and adopted across 11 command files."}
{"id":"seeds-4d5b","title":"Add ID and reference highlighting","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T16:59:56.996Z","updatedAt":"2026-02-24T17:48:46.572Z","description":"Highlight all IDs (cn-XXXX format) in amber/accent color throughout CLI output. Also highlight version references (@version), prompt name references, and cross-tool references per visual-spec.md. Context words around IDs should be dim.","blockedBy":["seeds-4a4d"],"closedAt":"2026-02-24T17:48:46.572Z","closeReason":"Implemented via merge-fix-builder: fmt.id (palette.accent) for ID highlighting added to output.ts and used across command files."}
{"id":"seeds-eec0","title":"Add --version --json rich metadata envelope","status":"open","type":"task","priority":1,"createdAt":"2026-02-24T17:00:02.012Z","updatedAt":"2026-02-24T17:00:02.012Z","description":"When -v/--version is combined with --json, output rich envelope: {name: '@os-eco/canopy-cli', version: '<semver>', runtime: 'bun', platform: '<os>-<arch>'}. Bare semver output without --json remains unchanged."}
{"id":"seeds-d32a","title":"Add --quiet/-q global flag","status":"open","type":"task","priority":2,"createdAt":"2026-02-24T17:00:03.774Z","updatedAt":"2026-02-24T17:00:03.774Z","description":"Add --quiet/-q global flag to suppress all non-error output. All commands must respect this flag. When combined with --json, only error envelopes should be emitted. Wire into commander as a global option."}
{"id":"seeds-f652","title":"Add --verbose global flag","status":"open","type":"task","priority":2,"createdAt":"2026-02-24T17:00:05.161Z","updatedAt":"2026-02-24T17:00:05.161Z","description":"Add --verbose global flag for extra diagnostic output. Wire into commander as a global option. Commands can optionally emit additional context when verbose is enabled."}
{"id":"seeds-2900","title":"Add --timing flag","status":"closed","type":"task","priority":3,"createdAt":"2026-02-24T17:00:07.262Z","updatedAt":"2026-02-25T16:59:37.820Z","description":"Add --timing global flag that emits execution time to stderr after command completes. Format: '[debug] completed in <N>ms' in dim text. Must not interfere with --json piping (stderr only).","closedAt":"2026-02-25T16:59:37.820Z"}
{"id":"seeds-e7b9","title":"Audit and fix JSON error routing","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T17:00:09.104Z","updatedAt":"2026-02-25T16:59:40.320Z","description":"Ensure all commands follow cli-standards.md error routing: with --json, errors go to stdout inside envelope {success:false, command, error}. Without --json, errors go to stderr as colored text. Audit all command files for compliance.","closedAt":"2026-02-25T16:59:40.320Z"}
{"id":"seeds-5b0c","title":"Audit process.exitCode usage","status":"closed","type":"task","priority":2,"createdAt":"2026-02-24T17:00:11.621Z","updatedAt":"2026-02-25T16:59:39.725Z","description":"Per cli-standards.md, use process.exitCode = 1 everywhere instead of process.exit(). Canopy uses ExitError pattern (throw instead of exit) which is compatible, but audit all paths to ensure no direct process.exit() calls remain and exitCode is set correctly on error paths.","closedAt":"2026-02-25T16:59:39.725Z"}
{"id":"seeds-9ac2","title":"Implement cn doctor command (8 checks)","status":"open","type":"task","priority":1,"createdAt":"2026-02-24T17:00:17.207Z","updatedAt":"2026-02-24T17:00:34.608Z","description":"Implement cn doctor with 8 checks per cli-standards.md: (1) .canopy/ directory exists, (2) config.yaml valid, (3) prompts.jsonl parseable, (4) no orphan versions, (5) schemas.jsonl valid, (6) emitted files up to date, (7) .gitattributes merge=union set for .canopy/*.jsonl, (8) CLAUDE.md canopy section present. Output: green ✓ for pass, red ✗ for fail, summary line.","blocks":["seeds-c2c4"]}
{"id":"seeds-c2c4","title":"Add --fix flag to cn doctor","status":"open","type":"task","priority":2,"createdAt":"2026-02-24T17:00:19.850Z","updatedAt":"2026-02-24T17:00:34.608Z","description":"Add --fix flag to cn doctor that auto-remediates fixable issues: create missing .canopy/ dir, add gitattributes entries, run cn onboard for CLAUDE.md section, run cn emit --all for stale emitted files. Non-fixable issues should report 'manual fix required'.","blockedBy":["seeds-9ac2"]}
{"id":"seeds-f7d2","title":"Implement cn upgrade command","status":"open","type":"task","priority":2,"createdAt":"2026-02-24T17:00:21.608Z","updatedAt":"2026-02-24T17:00:21.608Z","description":"Implement cn upgrade for self-update. Should check npm registry for latest @os-eco/canopy-cli version, compare with current, and install update via bun/npm. Include --check flag that only reports whether an update is available without installing."}
{"id":"seeds-4c79","title":"Add typo suggestions for unknown commands","status":"closed","type":"task","priority":3,"createdAt":"2026-02-24T17:00:25.960Z","updatedAt":"2026-02-25T16:59:38.301Z","description":"When user enters an unknown command, suggest closest match using Levenshtein distance or similar. Example: 'cn craete' → 'Did you mean cn create?' Overstory already has this — follow same pattern.","closedAt":"2026-02-25T16:59:38.301Z"}
{"id":"seeds-1704","title":"Implement shell completions generation","status":"closed","type":"task","priority":3,"createdAt":"2026-02-24T17:00:27.901Z","updatedAt":"2026-02-25T16:59:38.907Z","description":"Add cn --completions <shell> flag to generate shell completions for bash, zsh, and fish. Output completion script to stdout for piping to completion file. Overstory already has this — follow same pattern.","closedAt":"2026-02-25T16:59:38.907Z"}
{"id":"seeds-9814","title":"Merge-fix: resolve output.ts palette conflict and finish visual overhaul","status":"closed","type":"task","priority":1,"createdAt":"2026-02-24T17:42:12.968Z","updatedAt":"2026-02-24T17:48:47.852Z","description":"The icons-complete-builder branch (overstory/icons-complete-builder/seeds-4da2) has a merge conflict with main in src/output.ts. Main has palette as arrow functions, branch has direct chalk instances (better — enables chaining). Resolve by adopting the branch's chalk instance style. After merge-fix, also finish any remaining work for seeds-af72 (message formats) and seeds-4d5b (ID highlighting) — the branch already added fmt and icons exports that partially cover these.","closedAt":"2026-02-24T17:48:47.852Z","closeReason":"Merge conflict resolved, palette adopted as chalk instances, icons+fmt exports merged, all visual overhaul work complete."}
{"id":"seeds-3130","title":"Frontmatter support for prompts","status":"closed","type":"epic","priority":1,"createdAt":"2026-02-25T19:44:28.740Z","updatedAt":"2026-02-25T20:43:06.576Z","description":"Add first-class YAML frontmatter support to Canopy prompts. Frontmatter is stored as `Record<string, unknown>` on the Prompt type, participates in inheritance (shallow-merge, child wins), and is emitted as a `---` delimited YAML block at the top of rendered markdown files.\n\n## Motivation\n\nClaude Code agent files (`.claude/agents/*.md`) require structured YAML frontmatter for agent discovery, model selection, tool restriction, and orchestration. Examples from production:\n\n```yaml\n---\nname: database-build-agent\ndescription: Implements database changes from specs\ntools:\n  - Read\n  - Write\n  - Edit\n  - Bash\nmodel: sonnet\ncolor: green\nreadOnly: false\ncontextContract:\n  requires:\n    - type: spec_file\n      key: SPEC\n      required: true\n  produces:\n    files:\n      scope: \"app/src/db/**\"\n---\n```\n\nCurrently `cn emit` produces plain markdown with only `## Section` headers — no frontmatter. Users managing agent prompts with Canopy lose this critical metadata.\n\n## Design Decisions\n\n1. **Storage**: `frontmatter?: Record<string, unknown>` on Prompt type in JSONL (JSON handles arbitrary nesting)\n2. **Auto-population**: Emitted frontmatter always includes `name` (from Prompt.name) and `description` (if set). User-defined frontmatter keys are merged on top.\n3. **Inheritance**: Shallow merge at top level — child frontmatter keys override parent. Consistent with section override behavior.\n4. **YAML handling**: New `src/frontmatter.ts` module with YAML subset parser/serializer (handles scalars, arrays, nested objects). Existing `src/yaml.ts` only does flat key-value + one-level nesting — insufficient for tools lists, contextContract, etc.\n5. **CLI**: `--fm key=value` repeatable flag for create/update. CLI values stored as strings. Complex structures come via `cn import`.\n6. **Import**: `extractFrontmatter()` parses YAML frontmatter from imported .md files, maps `name`/`description` to Prompt fields, stores rest in `frontmatter`.\n\n## Scope\n\n- New module: `src/frontmatter.ts` (YAML subset parser/serializer)\n- Type change: `src/types.ts` (add frontmatter field)\n- Render engine: `src/render.ts` (frontmatter merging during inheritance)\n- Emit: `src/commands/emit.ts` (prepend frontmatter to markdown output)\n- Import: `src/commands/import.ts` (extract frontmatter from imported files)\n- Create/Update: `src/commands/create.ts`, `src/commands/update.ts` (--fm flag)\n- Display: `src/commands/show.ts`, `src/commands/render.ts` (show frontmatter)\n- Tests for all of the above\n\n## Child Issues\n\nSee linked task issues for implementation breakdown.","closedAt":"2026-02-25T20:43:06.576Z","closeReason":"All 7 child tasks complete. Frontmatter support added: types.ts (field), frontmatter.ts (YAML parser/serializer), create/update (--fm flag), render.ts (inheritance merging), import.ts (frontmatter extraction), emit.ts (frontmatter prepend), show/render (display). 7 merge_ready signals sent to coordinator."}
{"id":"seeds-3d74","title":"Add frontmatter field to Prompt type","status":"closed","type":"task","priority":1,"createdAt":"2026-02-25T19:44:36.978Z","updatedAt":"2026-02-25T20:43:06.312Z","description":"Add `frontmatter?: Record<string, unknown>` to the Prompt interface in `src/types.ts`.\n\n## Changes\n\n**`src/types.ts` (line ~18, after `pinned`):**\n```typescript\nexport interface Prompt {\n  // ... existing fields ...\n  pinned?: number;\n  frontmatter?: Record<string, unknown>;  // NEW\n  status: \"draft\" | \"active\" | \"archived\";\n  // ...\n}\n```\n\n**`src/render.ts` (line ~4-8, RenderResult interface):**\n```typescript\nexport interface RenderResult {\n  sections: Section[];\n  frontmatter: Record<string, unknown>;  // NEW\n  resolvedFrom: string[];\n  version: number;\n}\n```\n\n## Notes\n- This is a non-breaking change — field is optional, existing JSONL records without it parse fine\n- All downstream changes depend on this\n- No test changes needed for this alone\n\n## Parent\nPart of seeds-3130 (Frontmatter support for prompts)","blocks":["seeds-ee6c","seeds-d008","seeds-ff2b","seeds-7206"],"closedAt":"2026-02-25T20:43:06.312Z","closeReason":"Frontmatter field added to Prompt type and RenderResult. Types-builder verified: all tests pass, lint+typecheck clean."}
{"id":"seeds-ee6c","title":"Create frontmatter.ts YAML subset parser/serializer","status":"closed","type":"task","priority":1,"createdAt":"2026-02-25T19:44:53.767Z","updatedAt":"2026-02-25T20:43:06.350Z","description":"Create `src/frontmatter.ts` with YAML frontmatter extraction and rendering capabilities.\n\n## Public API\n\n```typescript\n/** Extract YAML frontmatter from markdown content. Returns parsed metadata + remaining body. */\nexport function extractFrontmatter(content: string): {\n  metadata: Record<string, unknown>;\n  body: string;\n}\n\n/** Serialize a metadata object to a YAML frontmatter block (with --- delimiters). */\nexport function renderFrontmatter(metadata: Record<string, unknown>): string\n```\n\n## Why not extend src/yaml.ts?\n\nThe existing yaml.ts only handles flat key-value pairs and one-level nested maps. Agent frontmatter requires:\n- **Arrays**: `tools:\\n  - Read\\n  - Write` (YAML list syntax)\n- **Arrays of objects**: `requires:\\n  - type: spec_file\\n    key: SPEC`\n- **Deep nesting**: `contextContract:\\n  requires:\\n    - type: ...`\n- **Booleans**: `readOnly: true`\n- **Numbers**: Not quoted\n\nExtending yaml.ts would break its simplicity. Better as a separate focused module.\n\n## Parser Requirements\n\nHandles `---` delimited frontmatter at file start:\n```\n---\nname: my-agent\ntools:\n  - Read\n  - Write\nmodel: sonnet\ncontextContract:\n  requires:\n    - type: spec_file\n      key: SPEC\n---\n\n## role\n\nBody content here\n```\n\nMust handle:\n- Scalar values (strings, numbers, booleans)\n- Quoted strings (single and double)\n- YAML sequences (`- item` syntax) — both scalar items and object items\n- Nested mappings (indented key: value blocks)\n- Comments (`#`) and empty lines\n- Content with no frontmatter (returns empty metadata, full content as body)\n- Inline comments stripping\n\nDoes NOT need:\n- Flow syntax (`[a, b]` or `{a: b}`)\n- Multi-line scalars (`|`, `>`)\n- Anchors/aliases (`&`, `*`)\n- Tags (`!!str`, etc.)\n\n## Serializer Requirements\n\nProduces clean, readable YAML:\n```typescript\nrenderFrontmatter({ name: \"builder\", model: \"sonnet\", tools: [\"Read\", \"Write\"], readOnly: true })\n// Returns:\n// ---\n// name: builder\n// model: sonnet\n// tools:\n//   - Read\n//   - Write\n// readOnly: true\n// ---\n```\n\nMust handle:\n- Strings → `key: value` or `key: \"quoted\"` (quote if contains `:`, `#`, etc.)\n- Numbers → `key: 123`\n- Booleans → `key: true`\n- Arrays of scalars → `key:\\n  - item1\\n  - item2`\n- Arrays of objects → `key:\\n  - field1: val1\\n    field2: val2`\n- Nested objects → `key:\\n  child: value` (recursive)\n- Empty object → returns empty string (no --- block)\n\n## Tests (`src/frontmatter.test.ts`)\n\nTest cases:\n1. Extract frontmatter from file with frontmatter\n2. Extract from file without frontmatter (returns empty metadata)\n3. Extract from file with only frontmatter (empty body)\n4. Parse flat key-value pairs\n5. Parse YAML lists (tools list)\n6. Parse nested objects (contextContract)\n7. Parse arrays of objects (contextContract.requires)\n8. Parse booleans and numbers\n9. Parse quoted strings\n10. Serialize flat key-value\n11. Serialize arrays\n12. Serialize nested objects\n13. Serialize booleans/numbers\n14. Round-trip: parse then serialize produces equivalent output\n15. Handle edge cases: empty frontmatter, missing closing ---, content with --- in body\n\n## Parent\nPart of seeds-3130 (Frontmatter support for prompts)","blockedBy":["seeds-3d74"],"blocks":["seeds-d008","seeds-f8f3","seeds-ff2b"],"closedAt":"2026-02-25T20:43:06.350Z","closeReason":"Created src/frontmatter.ts with extractFrontmatter and renderFrontmatter exports plus 27 tests. Handles scalars, arrays, nested objects, booleans, numbers, quoted strings."}
{"id":"seeds-d008","title":"Add frontmatter merging to render engine","status":"closed","type":"task","priority":1,"createdAt":"2026-02-25T19:45:05.557Z","updatedAt":"2026-02-25T20:43:06.387Z","description":"Modify `src/render.ts` to merge frontmatter during inheritance resolution.\n\n## Changes\n\n**`src/render.ts`:**\n\n1. Update `RenderResult` interface (line 4-8):\n```typescript\nexport interface RenderResult {\n  sections: Section[];\n  frontmatter: Record<string, unknown>;  // NEW\n  resolvedFrom: string[];\n  version: number;\n}\n```\n\n2. In `resolveInner` — no-parent case (line 44-51):\n- Return `frontmatter: prompt.frontmatter ?? {}`\n\n3. In `resolveInner` — extends case (line 54-64):\n- Merge parent and child frontmatter: `mergeFrontmatter(parentResult.frontmatter, prompt.frontmatter ?? {})`\n- Return merged frontmatter in result\n\n4. Add `mergeFrontmatter` helper:\n```typescript\nfunction mergeFrontmatter(\n  parent: Record<string, unknown>,\n  child: Record<string, unknown>,\n): Record<string, unknown> {\n  return { ...parent, ...child };\n}\n```\n\nShallow merge — child keys override parent. Consistent with how sections work (child section replaces parent section entirely, not deep-merged).\n\n## Test Updates (`src/render.test.ts`)\n\nAdd test cases:\n1. Returns own frontmatter when no parent\n2. Inherits parent frontmatter\n3. Child frontmatter overrides parent keys\n4. Mixed: some keys inherited, some overridden, some new\n5. Empty frontmatter on child still inherits parent\n6. Prompt without frontmatter field returns `{}`\n\n## Dependencies\n- Depends on seeds-3d74 (type change)\n\n## Parent\nPart of seeds-3130 (Frontmatter support for prompts)","blockedBy":["seeds-3d74","seeds-ee6c"],"blocks":["seeds-f8f3","seeds-9487"],"closedAt":"2026-02-25T20:43:06.387Z","closeReason":"Added frontmatter merging to render engine with shallow merge inheritance. mergeFrontmatter helper, 6 new tests, all quality gates pass."}
{"id":"seeds-f8f3","title":"Emit frontmatter in cn emit output","status":"closed","type":"task","priority":1,"createdAt":"2026-02-25T19:45:17.889Z","updatedAt":"2026-02-25T20:43:06.502Z","description":"Modify `src/commands/emit.ts` to prepend YAML frontmatter to emitted markdown files.\n\n## Changes\n\n**`src/commands/emit.ts`:**\n\n1. Import `renderFrontmatter` from `../frontmatter.ts`\n\n2. Rename/modify `sectionsToMarkdown` → accept frontmatter parameter:\n```typescript\nfunction promptToMarkdown(\n  sections: { name: string; body: string }[],\n  frontmatter: Record<string, unknown>,\n  promptName: string,\n  promptDescription?: string,\n): string {\n  // Build combined frontmatter: name + description + user-defined\n  const combined: Record<string, unknown> = { name: promptName };\n  if (promptDescription) combined.description = promptDescription;\n  Object.assign(combined, frontmatter);\n  \n  const fmBlock = renderFrontmatter(combined);  // Returns \"---\\n...\\n---\\n\" or \"\"\n  const sectionsMd = sections.map(s => \\`## \\${s.name}\\n\\n\\${s.body}\\`).join(\"\\n\\n\") + \"\\n\";\n  return fmBlock ? fmBlock + \"\\n\" + sectionsMd : sectionsMd;\n}\n```\n\n3. Update `emitPrompt` (line 30-54):\n- Pass `result.frontmatter`, `prompt.name`, `prompt.description` to the render function\n- The resolved frontmatter comes from `resolvePrompt()` which now handles inheritance\n\n4. Update all other call sites:\n- Check mode (line 120-140): use same rendering for comparison\n- Single prompt emit (line 214-236): use same rendering\n- Dry-run paths don't render content, no change needed\n\n## Key Behavior\n- Every emitted file gets a frontmatter block with at minimum `name`\n- `description` is included if the prompt has one\n- User-defined frontmatter keys (model, tools, color, etc.) follow after\n- Order: name, description, then user keys in insertion order\n- If combined frontmatter only has `name` and it matches the filename stem, still emit it (consistent, machine-parseable)\n\n## Test Updates (`src/commands/emit.test.ts`)\n\n1. Existing \"emits a prompt to a file\" test: verify output contains `---` frontmatter block with `name`\n2. New: emit with custom frontmatter keys shows them in output\n3. New: emit with inheritance shows merged frontmatter\n4. New: import+emit round-trip preserves frontmatter\n5. Check mode: verify stale detection works with frontmatter changes\n\n## Dependencies\n- Depends on seeds-3d74 (type change), seeds-ee6c (frontmatter module), seeds-XXXX (render merging)\n\n## Parent\nPart of seeds-3130 (Frontmatter support for prompts)","blockedBy":["seeds-d008","seeds-ee6c"],"closedAt":"2026-02-25T20:43:06.502Z","closeReason":"Emit command now prepends YAML frontmatter to all emitted files. sectionsToMarkdown renamed to promptToMarkdown, all call sites updated, 3 new tests."}
{"id":"seeds-ff2b","title":"Parse frontmatter on cn import","status":"closed","type":"task","priority":2,"createdAt":"2026-02-25T19:45:30.057Z","updatedAt":"2026-02-25T20:43:06.465Z","description":"Modify `src/commands/import.ts` to extract and store YAML frontmatter from imported markdown files.\n\n## Changes\n\n**`src/commands/import.ts`:**\n\n1. Import `extractFrontmatter` from `../frontmatter.ts`\n\n2. Before `splitMarkdown(content)` call (line 102-104):\n```typescript\n// Extract frontmatter before splitting\nconst { metadata, body } = extractFrontmatter(content);\n\nconst sections: Section[] = noSplit\n  ? [{ name: \"body\", body: body.trim() }]\n  : splitMarkdown(body);  // Pass body without frontmatter\n```\n\n3. Map known frontmatter keys to Prompt fields (after prompt construction, line 133-141):\n```typescript\n// Map frontmatter description to prompt description\nif (metadata.description && typeof metadata.description === \"string\") {\n  prompt.description = metadata.description;\n}\n\n// Store remaining frontmatter (excluding name/description which are Prompt fields)\nconst { name: _name, description: _desc, ...restFrontmatter } = metadata;\nif (Object.keys(restFrontmatter).length > 0) {\n  prompt.frontmatter = restFrontmatter;\n}\n```\n\n4. `--name` flag still takes priority over frontmatter name (current behavior preserved)\n\n## Key Behavior\n- Import a file with frontmatter → frontmatter is parsed and stored\n- Import a file without frontmatter → works exactly as before (no breaking change)\n- `name` from frontmatter is informational only (`--name` flag is required and authoritative)\n- `description` from frontmatter populates `prompt.description`\n- All other frontmatter keys go into `prompt.frontmatter`\n\n## Test Cases\n1. Import file with frontmatter → verify frontmatter stored on prompt\n2. Import file without frontmatter → works as before\n3. Import file with description in frontmatter → prompt.description set\n4. Import file with model/tools/color → stored in prompt.frontmatter\n5. Import + emit round-trip preserves frontmatter\n\n## Dependencies\n- Depends on seeds-3d74 (type change), seeds-ee6c (frontmatter module)\n\n## Parent\nPart of seeds-3130 (Frontmatter support for prompts)","blockedBy":["seeds-3d74","seeds-ee6c"],"closedAt":"2026-02-25T20:43:06.465Z","closeReason":"Import command now extracts YAML frontmatter from imported .md files, maps description to prompt.description, stores remaining keys in prompt.frontmatter."}
{"id":"seeds-7206","title":"Add --fm flag to cn create and cn update","status":"closed","type":"task","priority":2,"createdAt":"2026-02-25T19:45:44.197Z","updatedAt":"2026-02-25T20:43:06.426Z","description":"Add `--fm key=value` repeatable flag to both `cn create` and `cn update` commands. Add `--remove-fm key` to `cn update`.\n\n## Changes\n\n### `src/commands/create.ts`\n\n1. Add parsing for `--fm` flag in the arg loop (after line 83):\n```typescript\n} else if (arg === \"--fm\" && args[i + 1]) {\n  const fmArg = args[++i] ?? \"\";\n  const eqIdx = fmArg.indexOf(\"=\");\n  if (eqIdx !== -1) {\n    const fmKey = fmArg.slice(0, eqIdx);\n    const fmValue = fmArg.slice(eqIdx + 1);\n    if (fmKey) frontmatterEntries[fmKey] = fmValue;\n  }\n}\n```\n\n2. Add to prompt construction (after line 155):\n```typescript\nif (Object.keys(frontmatterEntries).length > 0) prompt.frontmatter = frontmatterEntries;\n```\n\n3. Register `--fm` in commander (in register function):\n```typescript\n.option(\"--fm <key=value>\", \"Set frontmatter field (repeatable)\", \n  (v: string, a: string[]) => a.concat([v]), [] as string[])\n```\n\n4. Update help text to show `--fm` option\n\n### `src/commands/update.ts`\n\n1. Add parsing for `--fm` and `--remove-fm` flags:\n```typescript\nconst fmUpdates: Record<string, string> = {};\nconst fmRemovals: string[] = [];\n\n// In arg loop:\n} else if (arg === \"--fm\" && args[i + 1]) {\n  const fmArg = args[++i] ?? \"\";\n  const eqIdx = fmArg.indexOf(\"=\");\n  if (eqIdx !== -1) {\n    fmUpdates[fmArg.slice(0, eqIdx)] = fmArg.slice(eqIdx + 1);\n  }\n} else if (arg === \"--remove-fm\" && args[i + 1]) {\n  fmRemovals.push(args[++i] ?? \"\");\n}\n```\n\n2. Apply frontmatter mutations (after tag handling, ~line 180):\n```typescript\n// Frontmatter updates\nconst currentFm = { ...(updated.frontmatter ?? {}) };\nfor (const [k, v] of Object.entries(fmUpdates)) currentFm[k] = v;\nfor (const k of fmRemovals) delete currentFm[k];\nupdated.frontmatter = Object.keys(currentFm).length > 0 ? currentFm : undefined;\n```\n\n3. Register both flags in commander\n4. Update help text\n\n## CLI Usage\n\n```bash\n# Create with frontmatter\ncn create --name builder --fm model=sonnet --fm \"tools=Read, Write\" --fm color=green\n\n# Update frontmatter\ncn update builder --fm model=opus --fm output-style=academic-structured\n\n# Remove frontmatter key\ncn update builder --remove-fm output-style\n```\n\n## Notes\n- CLI values are always stored as strings. For structured data (arrays, objects), use `cn import`.\n- This is fine for the common case (model, color, output-style are all strings). Tools-as-comma-string works for simple cases.\n\n## Dependencies\n- Depends on seeds-3d74 (type change)\n\n## Parent\nPart of seeds-3130 (Frontmatter support for prompts)","blockedBy":["seeds-3d74"],"closedAt":"2026-02-25T20:43:06.426Z","closeReason":"Added --fm key=value repeatable flag to cn create and cn update, plus --remove-fm key to cn update. Commander registration, arg parsing, help text all updated."}
{"id":"seeds-9487","title":"Display frontmatter in cn show and cn render","status":"closed","type":"task","priority":3,"createdAt":"2026-02-25T19:45:54.841Z","updatedAt":"2026-02-25T20:43:06.540Z","description":"Update `src/commands/show.ts` and `src/commands/render.ts` to display frontmatter metadata.\n\n## Changes\n\n### `src/commands/show.ts`\n\nAfter tags/schema/pinned display (line ~86), add frontmatter display:\n```typescript\nif (prompt.frontmatter && Object.keys(prompt.frontmatter).length > 0) {\n  humanOut(\"Frontmatter:\");\n  for (const [key, value] of Object.entries(prompt.frontmatter)) {\n    const display = typeof value === \"object\" ? JSON.stringify(value) : String(value);\n    humanOut(\\`  \\${key}: \\${display}\\`);\n  }\n}\n```\n\nJSON mode: no change needed — prompt.frontmatter is already included in the raw prompt object output.\n\n### `src/commands/render.ts`\n\n1. Import `renderFrontmatter` from `../frontmatter.ts`\n\n2. In markdown format output (line 71-81), display frontmatter before sections:\n```typescript\n// After resolvedFrom line, before sections loop:\nif (Object.keys(result.frontmatter).length > 0) {\n  const combined: Record<string, unknown> = { name };\n  // ... same auto-population logic as emit\n  Object.assign(combined, result.frontmatter);\n  humanOut(\"---\");\n  // Display each key\n  for (const [key, value] of Object.entries(combined)) {\n    humanOut(\\`\\${key}: \\${typeof value === \"object\" ? JSON.stringify(value) : value}\\`);\n  }\n  humanOut(\"---\");\n  humanOut(\"\");\n}\n```\n\n3. In JSON format output (line 54-69), add `frontmatter` field:\n```typescript\njsonOut({\n  // ... existing fields ...\n  frontmatter: result.frontmatter,  // NEW\n});\n```\n\n## Dependencies\n- Depends on seeds-3d74 (type change), seeds-d008 (render merging)\n\n## Parent\nPart of seeds-3130 (Frontmatter support for prompts)","blockedBy":["seeds-d008"],"closedAt":"2026-02-25T20:43:06.540Z","closeReason":"Frontmatter displayed in cn show (Frontmatter: block) and cn render (JSON field + YAML block in markdown mode)."}
