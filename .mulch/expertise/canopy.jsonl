{"type":"failure","description":"--add-section in update.ts ignored --body: addSectionBody declared but never assigned by the arg parser","resolution":"Added name=body shorthand and --body lookahead to --add-section parsing, mirroring --section in create.ts. Removed stale sectionBody fallback. Wired --body through commander registration.","classification":"tactical","recorded_at":"2026-02-24T13:42:08.965Z","evidence":{"commit":"845828e"},"id":"mx-e78d97"}
{"type":"pattern","name":"section-arg-parsing","description":"CLI arg parsing for section flags: use indexOf('=') for name=body shorthand detection and lookahead (args[i+1] === '--body') for the two-flag form. Both create.ts --section and update.ts --add-section/--section follow this pattern. When adding new section-like flags, always implement both forms.","classification":"tactical","recorded_at":"2026-02-24T13:42:20.267Z","evidence":{"commit":"845828e"},"id":"mx-4f2107"}
{"type":"convention","content":"Commander registration must mirror raw arg parsing: when a flag accepts --body, the .action() handler must also forward opts.body to the args array. See update.ts lines 231-238 where --section and --add-section both conditionally push --body.","classification":"tactical","recorded_at":"2026-02-24T13:42:26.042Z","evidence":{"commit":"845828e"},"id":"mx-5025e9"}
{"type":"pattern","name":"repeatable-section-flags","description":"Repeatable section flags in update.ts: convert single addSectionName/addSectionBody vars to addSections[]{name,body} array; convert removeSectionName to removeSections[]. Parsing loop pushes into arrays (same lookahead for --body). Mutation loops over arrays. Commander registration uses accumulator (v,a)=>a.concat([v]) matching --tag pattern. .action() iterates arrays to rebuild args.","classification":"tactical","recorded_at":"2026-02-24T14:40:58.199Z","outcomes":[{"status":"success","agent":"update-builder"}],"id":"mx-2603c9"}
{"type":"pattern","name":"remove-section-splice-pattern","description":"--remove-section behavior: for non-inheriting prompts (no extends field), splice the section from the array entirely. For inheriting prompts (has extends), use body='' to suppress the inherited section during render. This avoids noise entries in the JSONL store.","classification":"tactical","recorded_at":"2026-02-24T14:46:50.220Z","outcomes":[{"status":"success","agent":"remove-section-builder"}],"id":"mx-54581e"}
{"type":"failure","description":".gitattributes check in init.ts used includes('merge=union') which is too broad: if seeds/mulch already added merge=union entries for their own JSONL files, canopy entries were silently skipped.","resolution":"Check for canopy-specific path (.canopy/prompts.jsonl) instead of generic merge=union string. Added test to verify entries are appended even when other tools' merge=union lines exist.","classification":"tactical","recorded_at":"2026-02-24T14:56:22.484Z","outcomes":[{"status":"success","agent":"init-fix-builder"}],"id":"mx-4e08f1"}
{"type":"pattern","name":"multi-issue-lead-falloff","description":"Leads dispatched with multiple issues (different files) may only complete the primary sling issue and exit. For best coverage, dispatch one lead per issue or accept that a second lead may be needed for remaining issues.","classification":"tactical","recorded_at":"2026-02-24T14:58:40.029Z","id":"mx-b8bcc6"}
{"type":"pattern","name":"brand-palette-output","description":"Brand palette constants in output.ts: export palette.brand (chalk.rgb(56,142,60) deep green), palette.accent (chalk.rgb(255,183,77) amber for IDs), palette.muted (chalk.rgb(120,120,110) stone gray for metadata). Legacy c helpers delegate to palette where applicable (green→brand, yellow→accent).","classification":"tactical","recorded_at":"2026-02-24T17:11:36.171Z","outcomes":[{"status":"success","agent":"palette-dim-builder"}],"id":"mx-0c887e"}
{"type":"pattern","name":"style-a-help-screen","description":"Style A help screen pattern for Commander CLI: override formatHelp via configureHelp(), check cmd.parent to delegate subcommand help to Commander default, iterate cmd.commands dynamically for command list, use palette.brand(chalk.bold) for tool name, palette.muted for version, chalk.green for command names, chalk.dim for args/flags, 18-char field with 2-space min gap for column alignment.","classification":"tactical","recorded_at":"2026-02-24T17:21:26.291Z","outcomes":[{"status":"success","agent":"help-screen-builder"}],"id":"mx-e37941"}
{"type":"pattern","name":"palette-chalk-instance-style","description":"palette in output.ts should use direct chalk instances (chalk.rgb(56,142,60)) not arrow function wrappers. Instances support chaining (palette.brand.bold(...)); arrow functions do not. All fmt helpers in output.ts rely on this.","classification":"tactical","recorded_at":"2026-02-24T17:47:12.900Z","outcomes":[{"status":"success","agent":"merge-fix-builder"}],"id":"mx-9f51e1"}
{"type":"pattern","name":"visual-branding-dispatch","description":"Visual branding overhaul dispatch pattern: palette (output.ts) must merge first since downstream tasks (icons, messages, highlighting) depend on palette constants. Phase 1: single lead for palette. Phase 2: parallel leads — one for help screen (index.ts), one for all command file changes (icons+messages+highlighting combined to avoid file area overlap).","classification":"tactical","recorded_at":"2026-02-24T17:49:36.899Z","id":"mx-23c03b"}
{"type":"failure","description":"Icons builder branch forked before palette merge caused merge conflict in output.ts (arrow functions vs chalk instances). Auto-merge-resolve failed.","resolution":"Dispatch a merge-fix lead to reimplement changes on updated main. Prevention: when Phase 2 leads depend on Phase 1 merges to shared files, ensure Phase 2 worktrees are created AFTER the Phase 1 merge.","classification":"tactical","recorded_at":"2026-02-24T17:49:42.973Z","id":"mx-bcab79"}
