{"type":"failure","description":"--add-section in update.ts ignored --body: addSectionBody declared but never assigned by the arg parser","resolution":"Added name=body shorthand and --body lookahead to --add-section parsing, mirroring --section in create.ts. Removed stale sectionBody fallback. Wired --body through commander registration.","classification":"tactical","recorded_at":"2026-02-24T13:42:08.965Z","evidence":{"commit":"845828e"},"id":"mx-e78d97"}
{"type":"pattern","name":"section-arg-parsing","description":"CLI arg parsing for section flags: use indexOf('=') for name=body shorthand detection and lookahead (args[i+1] === '--body') for the two-flag form. Both create.ts --section and update.ts --add-section/--section follow this pattern. When adding new section-like flags, always implement both forms.","classification":"tactical","recorded_at":"2026-02-24T13:42:20.267Z","evidence":{"commit":"845828e"},"id":"mx-4f2107"}
{"type":"convention","content":"Commander registration must mirror raw arg parsing: when a flag accepts --body, the .action() handler must also forward opts.body to the args array. See update.ts lines 231-238 where --section and --add-section both conditionally push --body.","classification":"tactical","recorded_at":"2026-02-24T13:42:26.042Z","evidence":{"commit":"845828e"},"id":"mx-5025e9"}
{"type":"pattern","name":"repeatable-section-flags","description":"Repeatable section flags in update.ts: convert single addSectionName/addSectionBody vars to addSections[]{name,body} array; convert removeSectionName to removeSections[]. Parsing loop pushes into arrays (same lookahead for --body). Mutation loops over arrays. Commander registration uses accumulator (v,a)=>a.concat([v]) matching --tag pattern. .action() iterates arrays to rebuild args.","classification":"tactical","recorded_at":"2026-02-24T14:40:58.199Z","outcomes":[{"status":"success","agent":"update-builder"}],"id":"mx-2603c9"}
{"type":"pattern","name":"remove-section-splice-pattern","description":"--remove-section behavior: for non-inheriting prompts (no extends field), splice the section from the array entirely. For inheriting prompts (has extends), use body='' to suppress the inherited section during render. This avoids noise entries in the JSONL store.","classification":"tactical","recorded_at":"2026-02-24T14:46:50.220Z","outcomes":[{"status":"success","agent":"remove-section-builder"}],"id":"mx-54581e"}
{"type":"failure","description":".gitattributes check in init.ts used includes('merge=union') which is too broad: if seeds/mulch already added merge=union entries for their own JSONL files, canopy entries were silently skipped.","resolution":"Check for canopy-specific path (.canopy/prompts.jsonl) instead of generic merge=union string. Added test to verify entries are appended even when other tools' merge=union lines exist.","classification":"tactical","recorded_at":"2026-02-24T14:56:22.484Z","outcomes":[{"status":"success","agent":"init-fix-builder"}],"id":"mx-4e08f1"}
